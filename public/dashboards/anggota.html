<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Anggota | KARTEJI</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,0,0" />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="icon" href="../assets/img/logo.png">

  <style>
    body { font-family: 'Outfit', sans-serif; }
    .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }
    .tab-active { background: #34d399 !important; color: #020617 !important; font-weight: 900; transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(52, 211, 153, 0.3); }
    
    /* Animasi List */
    .fade-in { animation: fadeIn 0.4s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    #loader { display: none; }
    #loader.active { display: flex; }
  </style>
</head>

<body class="min-h-screen bg-slate-950 text-slate-100 selection:bg-emerald-400 selection:text-slate-950">

  <div id="loader" class="fixed inset-0 z-[100] bg-slate-950/80 backdrop-blur-md items-center justify-center">
      <div class="flex flex-col items-center gap-3">
          <div class="w-10 h-10 border-4 border-emerald-400/20 border-t-emerald-400 rounded-full animate-spin"></div>
          <p class="text-[10px] font-black tracking-widest text-emerald-400 animate-pulse uppercase">Syncing Data</p>
      </div>
  </div>

  <header class="sticky top-0 z-30 px-4 py-4">
    <div class="mx-auto max-w-5xl glass rounded-[2rem] p-3 flex items-center justify-between">
      <div class="flex items-center gap-3 pl-2">
        <div class="w-10 h-10 bg-emerald-400 rounded-2xl flex items-center justify-center shadow-[0_0_15px_rgba(52,211,153,0.3)]">
            <span class="material-symbols-rounded text-slate-950">person</span>
        </div>
        <div class="hidden sm:block">
          <div class="text-sm font-black tracking-tight">KARTEJI</div>
          <div class="text-[10px] text-emerald-400 font-bold uppercase tracking-tighter">Portal Anggota</div>
        </div>
      </div>

      <div class="flex items-center gap-2">
        <div id="onlineStatus" class="flex items-center gap-1.5 px-3 py-1.5 rounded-xl bg-emerald-400/10 border border-emerald-400/20">
            <span class="relative flex h-2 w-2">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-400"></span>
            </span>
            <span class="text-[10px] font-black text-emerald-400">ONLINE</span>
        </div>
        <button id="logoutBtn" class="p-2.5 rounded-xl bg-rose-500/10 text-rose-400 border border-rose-500/20 hover:bg-rose-500 hover:text-white transition-all">
            <span class="material-symbols-rounded text-sm">logout</span>
        </button>
      </div>
    </div>
  </header>

  <main id="content" class="hidden mx-auto max-w-5xl px-4 pb-20 space-y-6">
    
    <section class="glass rounded-[2.5rem] p-6 sm:p-8 relative overflow-hidden">
        <div class="absolute top-0 right-0 w-32 h-32 bg-emerald-400/5 blur-3xl rounded-full"></div>
        <div class="flex flex-col sm:flex-row items-center gap-6">
            <div class="relative group">
                <img id="mePhoto" class="h-24 w-24 rounded-3xl border-4 border-white/5 object-cover shadow-2xl" src="https://via.placeholder.com/150">
                <label for="mePhotoInput" class="absolute -bottom-2 -right-2 p-2 bg-emerald-400 text-slate-950 rounded-xl cursor-pointer hover:scale-110 transition-all shadow-lg">
                    <span class="material-symbols-rounded text-sm">photo_camera</span>
                </label>
                <input id="mePhotoInput" type="file" class="hidden" accept="image/*">
            </div>
            
            <div class="text-center sm:text-left flex-1">
                <h1 id="meNameText" class="text-2xl font-black tracking-tight">-</h1>
                <p id="meRoleText" class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4 italic">Anggota</p>
                
                <div class="flex flex-wrap justify-center sm:justify-start gap-2">
                    <input id="meName" class="bg-white/5 border border-white/10 rounded-xl px-4 py-2 text-xs outline-none focus:border-emerald-400 w-48" placeholder="Ubah Nama">
                    <button id="saveProfileBtn" class="bg-emerald-400 text-slate-950 px-5 py-2 rounded-xl text-xs font-black hover:bg-emerald-300 transition-all active:scale-95">UPDATE</button>
                </div>
            </div>
        </div>
    </section>

    <nav class="flex overflow-x-auto no-scrollbar gap-2 py-2">
        <button class="tabBtn whitespace-nowrap px-6 py-3 rounded-2xl glass text-[10px] font-black tracking-widest transition-all" data-tab="kegiatan">KEGIATAN</button>
        <button class="tabBtn whitespace-nowrap px-6 py-3 rounded-2xl glass text-[10px] font-black tracking-widest transition-all" data-tab="pengumuman">PENGUMUMAN</button>
        <button class="tabBtn whitespace-nowrap px-6 py-3 rounded-2xl glass text-[10px] font-black tracking-widest transition-all" data-tab="kas">KEUANGAN</button>
        <button class="tabBtn whitespace-nowrap px-6 py-3 rounded-2xl glass text-[10px] font-black tracking-widest transition-all" data-tab="anggota">MEMBER</button>
    </nav>

    <div id="tab-kegiatan" class="tabPanel space-y-4">
        <div class="flex items-center justify-between px-2">
            <h3 class="font-black text-xl italic tracking-tighter uppercase">Agenda Terbaru</h3>
            <button id="refreshBtn" class="p-2 text-emerald-400 hover:rotate-180 transition-all duration-500">
                <span class="material-symbols-rounded">sync</span>
            </button>
        </div>
        <div id="actList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    </div>

    <div id="tab-kas" class="tabPanel hidden space-y-6">
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div class="glass rounded-[2rem] p-6 border-l-4 border-emerald-400">
                <p class="text-[10px] font-black text-slate-500 uppercase">Kas Masuk</p>
                <h4 id="sumIncome" class="text-2xl font-black text-emerald-400 tracking-tighter">Rp 0</h4>
            </div>
            <div class="glass rounded-[2rem] p-6 border-l-4 border-rose-400">
                <p class="text-[10px] font-black text-slate-500 uppercase">Kas Keluar</p>
                <h4 id="sumExpense" class="text-2xl font-black text-rose-400 tracking-tighter">Rp 0</h4>
            </div>
            <div class="glass rounded-[2rem] p-6 bg-emerald-400 text-slate-950">
                <p class="text-[10px] font-black opacity-60 uppercase">Total Saldo</p>
                <h4 id="sumBalance" class="text-2xl font-black tracking-tighter">Rp 0</h4>
            </div>
        </div>
        <div id="finList" class="space-y-3"></div>
    </div>

    <div id="tab-pengumuman" class="tabPanel hidden space-y-4"><div id="nList" class="space-y-4"></div></div>
    <div id="tab-anggota" class="tabPanel hidden space-y-4">
        <div id="memberList" class="grid grid-cols-2 sm:grid-cols-4 gap-4"></div>
    </div>

  </main>

  <section id="gate" class="fixed inset-0 z-50 bg-slate-950 flex items-center justify-center p-6 hidden">
      <div class="glass max-w-xs w-full rounded-[2.5rem] p-8 text-center space-y-6">
          <div class="w-16 h-16 bg-rose-500/10 text-rose-500 rounded-3xl flex items-center justify-center mx-auto">
              <span class="material-symbols-rounded text-4xl">lock</span>
          </div>
          <div>
              <h2 class="font-black text-xl">AKSES DIBATASI</h2>
              <p id="gateMsg" class="text-xs text-slate-500 mt-2">Silahkan login terlebih dahulu untuk mengakses dashboard.</p>
          </div>
          <a href="/login.html" class="block w-full py-4 bg-emerald-400 text-slate-950 rounded-2xl font-black text-sm">LOGIN SEKARANG</a>
      </div>
  </section>

  <script type="module">
    // ... (Impor Firebase sama seperti kode Anda) ...

    // UI Helper: Animasi Tab
    window.openTab = (name) => {
      document.querySelectorAll(".tabPanel").forEach(p => p.classList.add("hidden"));
      document.querySelectorAll(".tabBtn").forEach(b => b.classList.remove("tab-active"));
      
      const target = document.getElementById(`tab-${name}`);
      target.classList.remove("hidden");
      target.classList.add("fade-in");
      
      document.querySelector(`.tabBtn[data-tab="${name}"]`).classList.add("tab-active");
    };

    // Fungsi tambahan untuk tampilan List Member yang lebih cantik
    async function loadMembers() {
        const list = document.getElementById("memberList");
        list.innerHTML = "";
        const snap = await getDocs(query(collection(db, "users"), orderBy("name","asc")));
        
        snap.forEach(d => {
            const u = d.data();
            const now = Date.now();
            const last = u.lastSeen?.toDate ? u.lastSeen.toDate().getTime() : 0;
            const isOnline = last && (now - last) <= (2 * 60 * 1000);

            const div = document.createElement("div");
            div.className = "glass p-4 rounded-3xl flex flex-col items-center text-center gap-2";
            div.innerHTML = `
                <div class="relative">
                    <img src="${u.photo?.url || 'https://via.placeholder.com/80'}" class="h-12 w-12 rounded-2xl object-cover ${!isOnline && 'grayscale'}">
                    ${isOnline ? '<span class="absolute -top-1 -right-1 w-3 h-3 bg-emerald-400 border-2 border-slate-950 rounded-full"></span>' : ''}
                </div>
                <p class="text-[10px] font-black truncate w-full uppercase">${u.name || 'Anonymous'}</p>
            `;
            list.appendChild(div);
        });
    }

    // Logic inti Firebase Anda tetap sama, cukup ganti pemanggilan DOM-nya.
    // Contoh untuk loadActivities dengan tampilan card:
    async function loadActivities(){
        const list = document.getElementById("actList");
        list.innerHTML = "";
        const qy = query(collection(db, "activities"), where("status","==","approved"), orderBy("createdAt","desc"));
        const snap = await getDocs(qy);

        snap.forEach(d => {
            const x = d.data();
            const div = document.createElement("div");
            div.className = "glass p-5 rounded-[2rem] space-y-3 hover:border-emerald-400/30 transition-all";
            div.innerHTML = `
                ${x.cover?.url ? `<img src="${x.cover.url}" class="w-full h-32 object-cover rounded-2xl">` : ''}
                <div>
                    <h4 class="font-black text-sm uppercase italic tracking-tight">${x.title}</h4>
                    <p class="text-[10px] text-slate-500 flex items-center gap-1 mt-1">
                        <span class="material-symbols-rounded text-xs">calendar_today</span> ${x.date || '-'}
                    </p>
                    <p class="text-xs text-slate-400 mt-2 line-clamp-2">${x.description || ''}</p>
                </div>
            `;
            list.appendChild(div);
        });
    }

    // Panggil fungsi inisialisasi seperti kode Anda...
  </script>
</body>
</html>
